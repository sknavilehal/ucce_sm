{% extends "base.html" %}
{% block meta %}
<link href="{{url_for('static', filename='css/signatures.css')}}" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.js"></script>
<link href="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.devbridge-autocomplete/1.4.10/jquery.autocomplete.min.js"></script>

<style>
    .dataTables_wrapper .dataTables_paginate .paginate_button.current
    {
      color:black !important;
      background:#a6d1f5;
      border:  1px solid #0087f7
    }
  


input[type=text] {
  position: absolute;
  top:3rem;
  padding: 15px 40px 15px 20px;
  
  color: #525252;
  font-family: "Montserrat", sans-serif;
  font-size: 16px;
  font-weight: 100;
  letter-spacing: 2px;
  border: none;
  border-radius: 5px;
  background: linear-gradient(to right, #FFFFFF 0%, #464747 #F9F9F9 100%);
  transition: width 0.4s ease;
  outline: none;
}

input[type=button] {
  position: absolute;
  top:3rem;
 left:55rem;
  padding: 15px 40px 15px 20px;
  width: 100px;
  color: #525252;
  font-family: "Montserrat", sans-serif;
  font-size: 16px;
  font-weight: 100;
  letter-spacing: 2px;
  border: none;
  border-radius: 5px;
  background:#00d0ff;
  transition: width 0.4s ease;
  outline: none;
}



.autocomplete-suggestion
{
  padding: 10px 30px 10px 10px;
  margin:0.2rem;
  width: 400px;
  color: #525252;
  font-family: "Montserrat", sans-serif;
  font-size: 13px;
  font-weight: 100;
  letter-spacing: 2px;
  border: none;
  border-radius: 5px;
  background: white;
  
  outline: none;
}

#submit:hover
{
cursor:pointer;
background-color: gainsboro;
}
.autocomplete-suggestion:hover
{
  cursor:pointer;
  background:#cff1fa;
  
  outline: none;
}

.autocomplete-selected
{
  cursor:pointer;
  background:#cff1fa;
  
  outline: none;
}

        </style>
    </style>
{% endblock %}
 {%block content%}
            <div class="row base-margin-bottom " style="margin-left: 10rem;">
                <div class="col-12 center">
                    

    <input type="text"  name="country" style="width:500px" id="autocomplete"/>
    <input type="button" id="submit" name="Submit"  style="width:100px;" value="Submit"/>
    <div class="output" style="background-color: white;">
      <p id="out"></p>
    </div>
    <div class="center">
<table id="table_id" style="width:80%" class=" hover order-column row-border">
</div>
                   
                </table>
                
            </div>
            {%endblock%}

</body>
{%block script%}
<script src="{{url_for('static',filename='js/signatures.js')}}"></script>
<script type="text/javascript">
 document.getElementById("table_id").innerHTML=""
    var countries = [
      { value: 'data' },
      { value: 'data.msg' },
      { value: 'data.msg.callid' },
      { value: 'dns.sequence' },
      { value: 'dns.sequence.jj' },
      {value:'DNIS'},
      {value:'ANI'},
      {value:'rckey'}
   ];
   let re  = /and\s|or\s|&&\s|\|\|\s/gi;
   $('#autocomplete').autocomplete({
       lookup: countries,
       delimiter:re,
       onSelect: function (suggestion) {
          // alert('You selected: ' + suggestion.value + ', ' + suggestion.data);
           
       },
       beforeRender: function (container) {
         console.log(document.getElementById("autocomplete").value)
       }
   });
   
   $('#submit').click(function()
   {
     //alert("ggg")
     var p=document.getElementById("autocomplete").value
     console.log(p)
     var person = {
               filter: p
           }
           if (document.getElementById("table_id").innerHTML!="") {
                var table1 = $('#table_id').DataTable();
                table1.destroy();
                document.getElementById("table_id").innerHTML=""

              //  console.log(document.getElementById("table_id").innerHTML.length)
           }
           //console.log(document.getElementById("table_id").innerHTML)
   
     $.ajax({
               url: 'http://127.0.0.1:8000/api/filter',
               type: 'post',
               dataType: 'json',
               contentType: 'application/json',
               success: function (data) {
                // temp=data.guids.toString().replace(/,/g,"<br>")
                  // document.getElementById("out").innerHTML=temp
                  files=[]
                  console.log(data.guids.length)
                  for(i=0;i<data.guids.length;i++)
            {
                files[i]=[]
                files[i]=[data.guids[i]]
            }
            /* if (document.getElementById("table_id").innerHTML != "") {
                var table1 = $('#table_id').DataTable();
                table1.destroy()
            }*/
            //document.getElementById('table_id').innerHTML = ""
            $('#table_id').DataTable(
    {scrollY:        '50vh',
        scrollCollapse: true,
        data: files,
            columns: [
                { title: "Filename" }
                
               
            ],
           
            } ); 
                   
               },
               data: JSON.stringify(person)
           });
   });
   </script>
{%endblock%}
</html>